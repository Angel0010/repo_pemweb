<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>SPOTIFY</title>
    <!-- Bootstrap CSS -->
    <link
      rel="stylesheet"
      href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css"
    />
  </head>
  <body>
    <div class="container mt-5">
      <h1>Spotify</h1>
      <button class="btn btn-primary" id="LoginBtn">
        Login dengan Spotify
      </button>
      <div id="playlistContainer" class="mt-3">
        <h2>Playlist Anda:</h2>
        <ul id="playList"></ul>
      </div>
    </div>

    <!-- jQuery and Bootstrap JS -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

    <!-- Spotify Web API dan Axios -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.24.0/axios.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/spotify-web-api-js/2.1.0/spotify-web-api.js"></script>

    <script>
      const spotifyAPI = new SpotifyWebApi({
        clientId: "0c159bee26af4266a7317417e5464dcc",
        clientSecret: "6a63f38aeb204525a2e0c51f9488d080",
        redirectUri: "http://localhost:3000",
      });

      const loginBtn = document.getElementById("LoginBtn");
      const playlistContainer = document.getElementById("playlistContainer");
      const playlistList = document.getElementById("playList");

      loginBtn.addEventListener("click", () => {
        const authorizeURL = spotifyAPI.createAuthorizeURL(
          ["user-read-private", "playlist-read-private"],
          "STATE"
        );
        window.location.href = authorizeURL;
      });

      const code = new URLSearchParams(window.location.search).get("code");
      if (code) {
        axios({
          method: "post",
          url: "https://accounts.spotify.com/api/token",
          data: `grant_type=authorization_code&code=${code}&redirect_uri=file:///C:/Users/Asus%20Vivobook/Documents/KULIAH/SEMESTER3/Pemweb/api.html`,
          headers: {
            "Content-Type": "application/x-www-form-urlencoded",
            Authorization:
              "Basic " +
              btoa(
                "0c159bee26af4266a7317417e5464dcc" +
                  ":" +
                  "6a63f38aeb204525a2e0c51f9488d080"
              ),
          },
        })
          .then((response) => {
            const accessToken = response.data.access_token;
            // Set token akses pada objek SpotifyWebApi
            spotifyAPI.setAccessToken(accessToken);

            // Mengambil daftar putar
            spotifyAPI
              .getUserPlaylists()
              .then((data) => {
                const playlists = data.body.items;
                playlists.forEach((playlist) => {
                  const listItem = document.createElement("li");
                  listItem.textContent = playlist.name;
                  playlistList.appendChild(listItem);
                });
                playlistContainer.style.display = "block";
              })
              .catch((error) => {
                console.error("Kesalahan:", error);
              });
          })
          .catch((error) => {
            console.error("Kesalahan:", error);
          });
      }
    </script>
  </body>
</html>
